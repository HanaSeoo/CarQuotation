package quotationCli;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;
import java.text.NumberFormat;
import java.util.Locale;

// ë°ì´í„° ì €ì¥ì„ ìœ„í•œ í´ë˜ìŠ¤ë“¤
class Option {
    String name;
    long price;
    List<String> prerequisites = new ArrayList<>(); // ì„ í–‰ ì¡°ê±´ ì˜µì…˜

    Option(String name, long price) {
        this.name = name;
        this.price = price;
    }

    Option(String name, long price, String... prerequisites) {
        this.name = name;
        this.price = price;
        this.prerequisites.addAll(Arrays.asList(prerequisites));
    }

    @Override
    public String toString() {
        return String.format("%s (%,dì›)", name, price);
    }
}

class Trim {
    String name;
    long price;
    List<Option> availableOptions;

    Trim(String name, long price, List<Option> availableOptions) {
        this.name = name;
        this.price = price;
        this.availableOptions = availableOptions;
    }

    @Override
    public String toString() {
        return String.format("%s (ê¸°ë³¸ %,dì›)", name, price);
    }
}

public class QuotationCli {

    // EV4 ë°ì´í„° ì´ˆê¸°í™”
    private static final Map<String, Trim> ev4Trims = new HashMap<>();
    private static final List<Option> ev4Colors = new ArrayList<>();

    static {
        // --- EV4 ì˜µì…˜ ë°ì´í„° ---
        // ê³µí†µ ì˜µì…˜
        Option driveWise = new Option("ë“œë¼ì´ë¸Œ ì™€ì´ì¦ˆ", 1280000);
        Option utility = new Option("ìœ í‹¸ë¦¬í‹°", 400000);
        Option wideSunroof = new Option("ì™€ì´ë“œ ì„ ë£¨í”„", 640000, "ìŠ¤íƒ€ì¼");
        Option builtInCam = new Option("ë¹ŒíŠ¸ì¸ ìº  2 í”ŒëŸ¬ìŠ¤", 450000);
        Option hud = new Option("í—¤ë“œì—… ë””ìŠ¤í”Œë ˆì´", 590000, "ëª¨ë‹ˆí„°ë§");
        Option harmanKardon = new Option("í•˜ë§Œì¹´ëˆ í”„ë¦¬ë¯¸ì—„ ì‚¬ìš´ë“œ", 640000);
        Option nineteenInchWheel = new Option("19ì¸ì¹˜ íœ &íƒ€ì´ì–´", 490000);

        // ì—ì–´ ì „ìš© ì˜µì…˜
        Option style = new Option("ìŠ¤íƒ€ì¼", 740000);
        Option comfort = new Option("ì»´í¬íŠ¸", 890000);
        Option convenience = new Option("ì»¨ë¹„ë‹ˆì–¸ìŠ¤", 890000);
        Option monitoring = new Option("ëª¨ë‹ˆí„°ë§", 1040000);
        
        List<Option> airOptions = Arrays.asList(style, comfort, convenience, nineteenInchWheel, monitoring, driveWise, utility, wideSunroof, builtInCam, hud);
        List<Option> earthOptions = Arrays.asList(nineteenInchWheel, driveWise, utility, wideSunroof, harmanKardon, builtInCam, hud);
        List<Option> gtLineOptions = Arrays.asList(driveWise, utility, wideSunroof, harmanKardon, builtInCam, hud);

        // --- EV4 íŠ¸ë¦¼ ë°ì´í„° ---
        ev4Trims.put("ì—ì–´ ìŠ¤íƒ ë‹¤ë“œ", new Trim("ì—ì–´ ìŠ¤íƒ ë‹¤ë“œ", 40420000, airOptions));
        ev4Trims.put("ì—ì–´ ë¡±ë ˆì¸ì§€", new Trim("ì—ì–´ ë¡±ë ˆì¸ì§€", 44620000, airOptions));
        ev4Trims.put("ì–´ìŠ¤ ìŠ¤íƒ ë‹¤ë“œ", new Trim("ì–´ìŠ¤ ìŠ¤íƒ ë‹¤ë“œ", 45010000, earthOptions));
        ev4Trims.put("ì–´ìŠ¤ ë¡±ë ˆì¸ì§€", new Trim("ì–´ìŠ¤ ë¡±ë ˆì¸ì§€", 49210000, earthOptions));
        ev4Trims.put("GT-line ìŠ¤íƒ ë‹¤ë“œ", new Trim("GT-line ìŠ¤íƒ ë‹¤ë“œ", 46110000, gtLineOptions));
        ev4Trims.put("GT-line ë¡±ë ˆì¸ì§€", new Trim("GT-line ë¡±ë ˆì¸ì§€", 50310000, gtLineOptions));

        // --- EV4 ìƒ‰ìƒ ë°ì´í„° ---
        ev4Colors.add(new Option("ê¸°ë³¸ ì»¬ëŸ¬", 0));
        ev4Colors.add(new Option("ìŠ¤ë…¸ìš° í™”ì´íŠ¸ í„", 80000));
        ev4Colors.add(new Option("ì•„ì´ë³´ë¦¬ ë§¤íŠ¸ ì‹¤ë²„", 300000));
        ev4Colors.add(new Option("ìš”íŠ¸ ë§¤íŠ¸ ë¸”ë£¨", 300000));
    }

    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        NumberFormat currencyFormatter = NumberFormat.getCurrencyInstance(Locale.KOREA);

        System.out.println("ğŸš— EV4 ê²¬ì  í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
        
        // 1. íŠ¸ë¦¼ ì„ íƒ
        System.out.println("\n--- 1. íŠ¸ë¦¼ ì„ íƒ ---");
        List<String> trimNames = new ArrayList<>(ev4Trims.keySet());
        for (int i = 0; i < trimNames.size(); i++) {
            System.out.printf("%d. %s\n", i + 1, ev4Trims.get(trimNames.get(i)));
        }
        System.out.print("ì›í•˜ëŠ” íŠ¸ë¦¼ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”: ");
        int trimChoice = Integer.parseInt(scanner.nextLine()) - 1;
        Trim selectedTrim = ev4Trims.get(trimNames.get(trimChoice));

        long totalPrice = selectedTrim.price;
        List<Option> selectedOptions = new ArrayList<>();
        
        // 2. ìƒ‰ìƒ ì„ íƒ
        System.out.println("\n--- 2. ì™¸ì¥ ìƒ‰ìƒ ì„ íƒ ---");
        for(int i = 0; i < ev4Colors.size(); i++) {
            System.out.printf("%d. %s\n", i + 1, ev4Colors.get(i));
        }
        System.out.print("ì›í•˜ëŠ” ìƒ‰ìƒì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”: ");
        int colorChoice = Integer.parseInt(scanner.nextLine()) - 1;
        Option selectedColor = ev4Colors.get(colorChoice);
        totalPrice += selectedColor.price;

        // 3. ì˜µì…˜ ì„ íƒ
        System.out.println("\n--- 3. ì¶”ê°€ ì˜µì…˜ ì„ íƒ ---");
        List<Option> availableOptions = selectedTrim.availableOptions;
        while (true) {
            System.out.println("ì„ íƒ ê°€ëŠ¥í•œ ì˜µì…˜ ëª©ë¡:");
            for (int i = 0; i < availableOptions.size(); i++) {
                Option opt = availableOptions.get(i);
                boolean isSelected = selectedOptions.contains(opt);
                String prerequisitesInfo = opt.prerequisites.isEmpty() ? "" : " (ì„ í–‰: " + String.join(", ", opt.prerequisites) + ")";
                System.out.printf("%d. %s %s %s\n", i + 1, opt, prerequisitesInfo, isSelected ? "[ì„ íƒë¨]" : "");
            }
            System.out.print("ì¶”ê°€í•  ì˜µì…˜ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ ì™„ë£Œ ì‹œ 0 ì…ë ¥): ");
            int optionChoice = Integer.parseInt(scanner.nextLine());

            if (optionChoice == 0) {
                break;
            }

            Option chosenOption = availableOptions.get(optionChoice - 1);
            
            // ì„ í–‰ ì¡°ê±´ ì²´í¬
            boolean prerequisitesMet = true;
            if (!chosenOption.prerequisites.isEmpty()) {
                for(String preqName : chosenOption.prerequisites) {
                    boolean found = false;
                    for(Option selectedOpt : selectedOptions) {
                        if(selectedOpt.name.equals(preqName)) {
                            found = true;
                            break;
                        }
                    }
                    if(!found) {
                        System.out.printf("!! ê²½ê³ : '%s' ì˜µì…˜ì„ ì„ íƒí•˜ë ¤ë©´ '%s' ì˜µì…˜ì´ ë¨¼ì € ì„ íƒë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\n", chosenOption.name, preqName);
                        prerequisitesMet = false;
                        break;
                    }
                }
            }

            if(prerequisitesMet && !selectedOptions.contains(chosenOption)) {
                selectedOptions.add(chosenOption);
                totalPrice += chosenOption.price;
                System.out.printf("-> '%s' ì˜µì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n", chosenOption.name);
            } else if (selectedOptions.contains(chosenOption)) {
                System.out.println("-> ì´ë¯¸ ì„ íƒëœ ì˜µì…˜ì…ë‹ˆë‹¤.");
            }
        }
        
        // 4. ìµœì¢… ê²¬ì  ì¶œë ¥
        System.out.println("\n--- ğŸ“œ ìµœì¢… ê²¬ì ì„œ ---");
        System.out.println("ì°¨ì¢…: Kia EV4");
        System.out.println("íŠ¸ë¦¼: " + selectedTrim.name);
        System.out.println("ì™¸ì¥ ìƒ‰ìƒ: " + selectedColor.name);
        System.out.println("ì¶”ê°€ ì˜µì…˜:");
        if (selectedOptions.isEmpty()) {
            System.out.println("- ì„ íƒ ì•ˆí•¨");
        } else {
            for (Option opt : selectedOptions) {
                System.out.println("- " + opt.name);
            }
        }
        System.out.println("--------------------");
        System.out.printf("ì´ ê°€ê²©: %sì›\n", currencyFormatter.format(totalPrice).replace("â‚©", ""));
        System.out.println("--------------------");

        scanner.close();
    }
}
